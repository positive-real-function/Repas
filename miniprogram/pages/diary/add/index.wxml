<!--pages/diary/add/index.wxml-->
<view class="edit-container">
  <!-- é¡¶éƒ¨ä¿¡æ¯æ  -->
  <view class="header-section">
    <view class="weather-mood">
      <view class="weather-display" bindtap="showWeatherPicker">
        <text class="label">å¤©æ°”</text>
        <text class="value">{{weather}}</text>
      </view>
      <view class="mood-display" bindtap="showMoodPicker">
        <text class="label">å¿ƒæƒ…</text>
        <text class="value">{{mood}}</text>
      </view>
    </view>
    <view class="date-location">
      <text class="date">{{currentDate}}</text>
      <text class="location" wx:if="{{location}}">ğŸ“ {{location}}</text>
    </view>
  </view>

  <!-- æ—¥è®°å†…å®¹ -->
  <view class="content-section">
    <textarea 
      class="content-input" 
      placeholder="è®°å½•ç”Ÿæ´»çš„ç‚¹ç‚¹æ»´æ»´..." 
      value="{{content}}"
      bindinput="onContentInput"
      maxlength="1000"
      auto-height
    ></textarea>
  </view>

  <!-- å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ -->
  <view class="image-section">
    <view class="section-title">æ·»åŠ å›¾ç‰‡</view>
    <view class="image-list">
      <view 
        class="image-item" 
        wx:for="{{images}}" 
        wx:key="*this"
        bindtap="previewImage"
        data-url="{{item}}"
      >
        <image src="{{item}}" mode="aspectFill"></image>
        <view 
          class="delete-btn"
          bindtap="deleteImage"
          data-index="{{index}}"
          catchtap="deleteImage"
        >Ã—</view>
      </view>
      <view 
        class="add-image"
        bindtap="chooseImage"
        wx:if="{{images.length < 9}}"
      >
        <text class="add-icon">+</text>
        <text class="add-text">{{images.length}}/9</text>
      </view>
    </view>
  </view>

  <!-- ä¿å­˜æŒ‰é’® -->
  <view class="button-section">
    <button class="save-button" bindtap="saveDiary">ä¿å­˜</button>
  </view>
</view>

<!-- å¿ƒæƒ…é€‰æ‹©å¼¹çª— -->
<view class="mood-picker {{showMoodPicker ? 'show' : ''}}" bindtap="hideMoodPicker">
  <view class="mood-picker-content" catchtap="stopPropagation">
    <view class="picker-title">é€‰æ‹©å¿ƒæƒ…</view>
    <view class="mood-grid">
      <view 
        wx:for="{{moods}}" 
        wx:key="*this"
        class="mood-item {{mood === item ? 'selected' : ''}}"
        bindtap="selectMood"
        data-mood="{{item}}"
      >
        <text class="mood-emoji">{{item}}</text>
      </view>
    </view>
  </view>
</view>

<!-- å¤©æ°”é€‰æ‹©å¼¹çª— -->
<view class="weather-picker {{showWeatherPicker ? 'show' : ''}}" bindtap="hideWeatherPicker">
  <view class="weather-picker-content" catchtap="stopPropagation">
    <view class="picker-title">é€‰æ‹©å¤©æ°”</view>
    <view class="weather-grid">
      <view 
        wx:for="{{weathers}}" 
        wx:key="*this"
        class="weather-item {{weather === item ? 'selected' : ''}}"
        bindtap="selectWeather"
        data-weather="{{item}}"
      >
        <text class="weather-emoji">{{item}}</text>
      </view>
    </view>
  </view>
</view>